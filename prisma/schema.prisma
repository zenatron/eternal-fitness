generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  age       Int?
  gender    String?
  height    Float?
  weight    Float?
  useMetric Boolean  @default(false)
  points    Int      @default(0)

  // Relations
  workoutTemplates WorkoutTemplate[]
  workoutSessions  WorkoutSession[]
  userStats        UserStats?
  monthlyStats     MonthlyStats[]
  weightGoal       Float?
}

model WorkoutTemplate {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String
  favorite    Boolean  @default(false)
  totalVolume Float    @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  exercises Exercise[]
  sessions  WorkoutSession[]
  sets       Set[]

  @@index([userId])
}

model WorkoutSession {
  id          String   @id @default(uuid())
  completedAt DateTime?
  scheduledAt DateTime?
  duration    Int?
  notes       String?
  totalVolume Float

  // Relations
  user              User            @relation(fields: [userId], references: [id])
  userId            String
  workoutTemplate   WorkoutTemplate @relation(fields: [workoutTemplateId], references: [id])
  workoutTemplateId String

  @@index([userId, completedAt])
}

model Exercise {
  id          String   @id @default(uuid())
  name        String
  description String?
  muscles     String[]
  equipment   String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Many-to-many relation to Set
  sets              Set[]            @relation("SetExercises")
  WorkoutTemplate   WorkoutTemplate? @relation(fields: [workoutTemplateId], references: [id])
  workoutTemplateId String?
}

model Set {
  id                String          @id @default(uuid())
  workoutTemplate   WorkoutTemplate @relation(fields: [workoutTemplateId], references: [id])
  workoutTemplateId String
  exercises         Exercise[]      @relation("SetExercises")
  reps              Int
  weight            Float
  duration          Int?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  volume            Float?          @default(0)
}

model UserStats {
  id                 String    @id @default(uuid())
  user               User      @relation(fields: [userId], references: [id])
  userId             String    @unique
  totalWorkouts      Int       @default(0)
  totalSets          Int       @default(0)
  totalExercises     Int       @default(0)
  totalVolume        Float     @default(0)
  totalTrainingHours Float     @default(0)
  currentStreak      Int       @default(0)
  longestStreak      Int       @default(0)
  lastWorkoutAt      DateTime?
  activeWeeks        Int       @default(0)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
}

model MonthlyStats {
  id            String   @id @default(uuid())
  user          User     @relation(fields: [userId], references: [id])
  userId        String
  year          Int
  month         Int
  workoutsCount Int      @default(0)
  volume        Float    @default(0)
  trainingHours Float    @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([userId, year, month])
}
